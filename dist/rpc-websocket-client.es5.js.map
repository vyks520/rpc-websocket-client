{"version":3,"file":"rpc-websocket-client.es5.js","sources":["../src/rpc-websocket-client.ts"],"sourcesContent":["import * as IUuid from 'uuid/interfaces';\r\nimport * as IWebSocket from 'isomorphic-ws';\r\n\r\nconst v1 = require('uuid/v1') as IUuid.v1;\r\nconst WebSocket = require('isomorphic-ws');\r\n\r\nexport type RpcEventFunction = (\r\n    e: IWebSocket.OpenEvent | IWebSocket.ErrorEvent\r\n) => void;\r\nexport type RpcMessageEventFunction = (e: IWebSocket.MessageEvent) => void;\r\nexport type RpcCloseEventFunction = (e: IWebSocket.CloseEvent) => void;\r\n\r\nexport type RpcNotificationEvent = (data: IRpcNotification) => void;\r\nexport type RpcRequestEvent = (data: IRpcRequest) => void;\r\nexport type RpcSuccessResponseEvent = (data: IRpcSuccessResponse) => void;\r\nexport type RpcErrorResponseEvent = (data: IRpcErrorResponse) => void;\r\n\r\nexport enum RpcVersions {\r\n    RPC_VERSION = '2.0'\r\n}\r\n\r\nexport type RpcId = string | number;\r\n\r\nexport interface IRpcData {\r\n    method: string;\r\n    params?: any;\r\n}\r\n\r\nexport interface IRpcNotification extends IRpcData {\r\n    jsonrpc: RpcVersions.RPC_VERSION;\r\n}\r\n\r\nexport interface IRpcRequest extends IRpcNotification {\r\n    // if not included its notification\r\n    id: RpcId;\r\n}\r\n\r\nexport interface IRpcResponse {\r\n    id: RpcId;\r\n    jsonrpc: RpcVersions.RPC_VERSION;\r\n}\r\n\r\nexport interface IRpcSuccessResponse extends IRpcResponse {\r\n    // if not included its notification\r\n    result: any;\r\n}\r\n\r\nexport interface IRpcError {\r\n    code: number;\r\n    message: string;\r\n    data?: any;\r\n}\r\n\r\nexport interface IRpcErrorResponse extends IRpcResponse {\r\n    error: IRpcError;\r\n}\r\n\r\nexport interface IRpcWebSocketConfig {\r\n    responseTimeout: number;\r\n}\r\n\r\nexport type RpcUnidentifiedMessage =\r\n    | IRpcRequest\r\n    | IRpcNotification\r\n    | IRpcSuccessResponse\r\n    | IRpcErrorResponse;\r\n\r\nexport class RpcWebSocketClient {\r\n    // native websocket\r\n    public ws: IWebSocket;\r\n\r\n    private idAwaiter: {\r\n        [id: string]: (data?: any) => void;\r\n    } = {};\r\n\r\n    public onOpenHandlers: RpcEventFunction[] = [];\r\n    public onAnyMessageHandlers: RpcMessageEventFunction[] = [];\r\n\r\n    public onNotification: RpcNotificationEvent[] = [];\r\n    public onRequest: RpcRequestEvent[] = [];\r\n    public onSuccessResponse: RpcSuccessResponseEvent[] = [];\r\n    public onErrorResponse: RpcErrorResponseEvent[] = [];\r\n\r\n    public onErrorHandlers: RpcEventFunction[] = [];\r\n    public onCloseHandlers: RpcCloseEventFunction[] = [];\r\n\r\n    public config: IRpcWebSocketConfig = {\r\n        responseTimeout: 10000\r\n    };\r\n\r\n    // constructor\r\n    /**\r\n     * Does not start WebSocket connection!\r\n     * You need to call connect() method first.\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public constructor() {\r\n        this.ws = undefined as any;\r\n    }\r\n\r\n    // public\r\n    /**\r\n     * Starts WebSocket connection. Returns Promise when connection is established.\r\n     * @param {string} url\r\n     * @param {(string | string[])} [protocols]\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public connect(url: string, protocols?: string | string[]) {\r\n        this.ws = new WebSocket(url, protocols);\r\n        return this.listen();\r\n    }\r\n\r\n    // events\r\n    public onOpen(fn: RpcEventFunction) {\r\n        this.onOpenHandlers.push(fn);\r\n    }\r\n\r\n    /**\r\n     * Native onMessage event. DO NOT USE THIS unless you really have to or for debugging purposes.\r\n     * Proper RPC events are onRequest, onNotification, onSuccessResponse and onErrorResponse (or just awaiting response).\r\n     * @param {RpcMessageEventFunction} fn\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public onAnyMessage(fn: RpcMessageEventFunction) {\r\n        this.onAnyMessageHandlers.push(fn);\r\n    }\r\n\r\n    public onError(fn: RpcEventFunction) {\r\n        this.onErrorHandlers.push(fn);\r\n    }\r\n\r\n    public onClose(fn: RpcCloseEventFunction) {\r\n        this.onCloseHandlers.push(fn);\r\n    }\r\n\r\n    /**\r\n     * Appends onmessage listener on native websocket with RPC handlers.\r\n     * If onmessage function was already there, it will call it on beggining.\r\n     * Useful if you want to use RPC WebSocket Client on already established WebSocket along with function changeSocket().\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public listenMessages() {\r\n        let previousOnMessage: RpcMessageEventFunction | undefined;\r\n        if (this.ws.onmessage) {\r\n            previousOnMessage = this.ws.onmessage.bind(this.ws);\r\n        }\r\n\r\n        this.ws.onmessage = (e: IWebSocket.MessageEvent) => {\r\n            if (previousOnMessage) {\r\n                previousOnMessage(e);\r\n            }\r\n\r\n            for (const handler of this.onAnyMessageHandlers) {\r\n                handler(e);\r\n            }\r\n\r\n            const data: RpcUnidentifiedMessage = JSON.parse(e.data.toString());\r\n            if (this.isNotification(data)) {\r\n                // notification\r\n                for (const handler of this.onNotification) {\r\n                    handler(data);\r\n                }\r\n            } else if (this.isRequest(data)) {\r\n                // request\r\n                for (const handler of this.onRequest) {\r\n                    handler(data);\r\n                }\r\n                // responses\r\n            } else if (this.isSuccessResponse(data)) {\r\n                // success\r\n                for (const handler of this.onSuccessResponse) {\r\n                    handler(data);\r\n                }\r\n\r\n                // resolve awaiting function\r\n                this.idAwaiter[data.id](data.result);\r\n            } else if (this.isErrorResponse(data)) {\r\n                // error\r\n                for (const handler of this.onErrorResponse) {\r\n                    handler(data);\r\n                }\r\n\r\n                // resolve awaiting function\r\n                this.idAwaiter[data.id](data.error);\r\n            }\r\n        };\r\n    }\r\n\r\n    // communication\r\n\r\n    /**\r\n     * Creates and sends RPC request. Resolves when appropirate response is returned from server or after config.responseTimeout.\r\n     * @param {string} method\r\n     * @param {*} [params]\r\n     * @returns\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public call(method: string, params?: any) {\r\n        return new Promise((resolve, reject) => {\r\n            const data = this.buildRequest(method, params);\r\n\r\n            // give limited time for response\r\n            let timeout: number | NodeJS.Timeout;\r\n            if (this.config.responseTimeout) {\r\n                timeout = setTimeout(() => {\r\n                    // stop waiting for response\r\n                    delete this.idAwaiter[data.id];\r\n                    reject(\r\n                        `Awaiting response to \"${method}\" with id: ${data.id} timed out.`\r\n                    );\r\n                }, this.config.responseTimeout);\r\n            }\r\n\r\n            // expect response\r\n            this.idAwaiter[data.id] = (responseData?: any) => {\r\n                // stop timeout\r\n                clearInterval(timeout as number);\r\n                // stop waiting for response\r\n                delete this.idAwaiter[data.id];\r\n\r\n                if (this.isRpcError(responseData)) {\r\n                    reject(responseData);\r\n                    return;\r\n                }\r\n\r\n                resolve(responseData);\r\n            };\r\n\r\n            const json = JSON.stringify(data);\r\n            this.ws.send(json);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Creates and sends RPC Notification.\r\n     * @param {string} method\r\n     * @param {*} [params]\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public notify(method: string, params?: any) {\r\n        this.ws.send(JSON.stringify(this.buildNotification(method, params)));\r\n    }\r\n\r\n    // setup\r\n\r\n    /**\r\n     * You can provide custom id generation function to replace default uuid/v1.\r\n     * @param {() => string} idFn\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public customId(idFn: () => string) {\r\n        this.idFn = idFn;\r\n    }\r\n\r\n    /**\r\n     * Removed jsonrpc from sent messages. Good if you don't care about standards or need better performance.\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public noRpc() {\r\n        this.buildRequest = this.buildRequestBase;\r\n        this.buildNotification = this.buildNotificationBase;\r\n        this.buildRpcSuccessResponse = this.buildRpcSuccessResponseBase;\r\n        this.buildRpcErrorResponse = this.buildRpcErrorResponseBase;\r\n    }\r\n\r\n    /**\r\n     * Allows modifying configuration.\r\n     * @param {RpcWebSocketConfig} options\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public configure(options: IRpcWebSocketConfig) {\r\n        Object.assign(this.config, options);\r\n    }\r\n\r\n    /**\r\n     * Allows you to change used native WebSocket client to another one.\r\n     * If you have already-connected WebSocket, use this with listenMessages().\r\n     * @param {WebSocket} ws\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public changeSocket(ws: IWebSocket) {\r\n        this.ws = ws;\r\n    }\r\n\r\n    // private\r\n\r\n    // events\r\n    private listen() {\r\n        return new Promise((resolve, reject) => {\r\n            this.ws.onopen = (e: IWebSocket.OpenEvent) => {\r\n                for (const handler of this.onOpenHandlers) {\r\n                    handler(e);\r\n                }\r\n                resolve(e);\r\n            };\r\n\r\n            // listen for messages\r\n            this.listenMessages();\r\n\r\n            // called before onclose\r\n            this.ws.onerror = (e: IWebSocket.ErrorEvent) => {\r\n                for (const handler of this.onErrorHandlers) {\r\n                    handler(e);\r\n                }\r\n            };\r\n\r\n            this.ws.onclose = (e: IWebSocket.CloseEvent) => {\r\n                for (const handler of this.onCloseHandlers) {\r\n                    handler(e);\r\n                }\r\n                reject(e);\r\n            };\r\n        });\r\n    }\r\n\r\n    // request\r\n    private buildRequest(method: string, params?: any): IRpcRequest {\r\n        const data = this.buildRequestBase(method, params);\r\n        data.jsonrpc = RpcVersions.RPC_VERSION;\r\n        return data;\r\n    }\r\n\r\n    private buildRequestBase(method: string, params?: any): IRpcRequest {\r\n        const data: IRpcRequest = {} as any;\r\n        data.id = this.idFn();\r\n        data.method = method;\r\n\r\n        if (params) {\r\n            data.params = params;\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    // notification\r\n    private buildNotification(method: string, params?: any): IRpcNotification {\r\n        const data = this.buildNotificationBase(method, params);\r\n        data.jsonrpc = RpcVersions.RPC_VERSION;\r\n        return data;\r\n    }\r\n\r\n    private buildNotificationBase(\r\n        method: string,\r\n        params?: any\r\n    ): IRpcNotification {\r\n        const data: IRpcNotification = {} as any;\r\n        data.method = method;\r\n\r\n        if (params) {\r\n            data.params = params;\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    // success response\r\n    private buildRpcSuccessResponse(\r\n        id: RpcId,\r\n        result: any\r\n    ): IRpcSuccessResponse {\r\n        const data = this.buildRpcSuccessResponseBase(id, result);\r\n        data.jsonrpc = RpcVersions.RPC_VERSION;\r\n        return data;\r\n    }\r\n\r\n    private buildRpcSuccessResponseBase(\r\n        id: RpcId,\r\n        result: any\r\n    ): IRpcSuccessResponse {\r\n        const data: IRpcSuccessResponse = {} as any;\r\n        data.id = id;\r\n        data.result = result;\r\n        return data;\r\n    }\r\n\r\n    // error response\r\n    private buildRpcErrorResponse(\r\n        id: RpcId,\r\n        error: IRpcError\r\n    ): IRpcErrorResponse {\r\n        const data = this.buildRpcErrorResponseBase(id, error);\r\n        data.jsonrpc = RpcVersions.RPC_VERSION;\r\n        return data;\r\n    }\r\n\r\n    private buildRpcErrorResponseBase(\r\n        id: RpcId,\r\n        error: IRpcError\r\n    ): IRpcErrorResponse {\r\n        const data: IRpcErrorResponse = {} as any;\r\n        data.id = id;\r\n        data.error = error;\r\n        return data;\r\n    }\r\n\r\n    private idFn(): RpcId {\r\n        return v1();\r\n    }\r\n\r\n    // tests\r\n    private isNotification(\r\n        data: RpcUnidentifiedMessage\r\n    ): data is IRpcNotification {\r\n        return !(data as any).id;\r\n    }\r\n\r\n    private isRequest(data: RpcUnidentifiedMessage): data is IRpcRequest {\r\n        return (data as any).method;\r\n    }\r\n\r\n    private isSuccessResponse(\r\n        data: RpcUnidentifiedMessage\r\n    ): data is IRpcSuccessResponse {\r\n        return data.hasOwnProperty(`result`);\r\n    }\r\n\r\n    private isErrorResponse(\r\n        data: RpcUnidentifiedMessage\r\n    ): data is IRpcErrorResponse {\r\n        return data.hasOwnProperty(`error`);\r\n    }\r\n\r\n    private isRpcError(data: any): data is IRpcError {\r\n        return typeof data?.code !== 'undefined';\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}