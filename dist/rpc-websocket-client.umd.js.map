{"version":3,"file":"rpc-websocket-client.umd.js","sources":["../src/rpc-websocket-client.ts"],"sourcesContent":["import * as IUuid from 'uuid/interfaces';\r\nimport * as IWebSocket from 'isomorphic-ws';\r\n\r\nconst v1 = require('uuid/v1') as IUuid.v1;\r\nconst WebSocket = require('isomorphic-ws');\r\n\r\nexport type RpcEventFunction = (\r\n    e: IWebSocket.OpenEvent | IWebSocket.ErrorEvent\r\n) => void;\r\nexport type RpcMessageEventFunction = (e: IWebSocket.MessageEvent) => void;\r\nexport type RpcCloseEventFunction = (e: IWebSocket.CloseEvent) => void;\r\n\r\nexport type RpcNotificationEvent = (data: IRpcNotification) => void;\r\nexport type RpcRequestEvent = (data: IRpcRequest) => void;\r\nexport type RpcSuccessResponseEvent = (data: IRpcSuccessResponse) => void;\r\nexport type RpcErrorResponseEvent = (data: IRpcErrorResponse) => void;\r\n\r\nexport enum RpcVersions {\r\n    RPC_VERSION = '2.0'\r\n}\r\n\r\nexport type RpcId = string | number;\r\n\r\nexport interface IRpcData {\r\n    method: string;\r\n    params?: any;\r\n}\r\n\r\nexport interface IRpcNotification extends IRpcData {\r\n    jsonrpc: RpcVersions.RPC_VERSION;\r\n}\r\n\r\nexport interface IRpcRequest extends IRpcNotification {\r\n    // if not included its notification\r\n    id: RpcId;\r\n}\r\n\r\nexport interface IRpcResponse {\r\n    id: RpcId;\r\n    jsonrpc: RpcVersions.RPC_VERSION;\r\n}\r\n\r\nexport interface IRpcSuccessResponse extends IRpcResponse {\r\n    // if not included its notification\r\n    result: any;\r\n}\r\n\r\nexport interface IRpcError {\r\n    code: number;\r\n    message: string;\r\n    data?: any;\r\n}\r\n\r\nexport interface IRpcErrorResponse extends IRpcResponse {\r\n    error: IRpcError;\r\n}\r\n\r\nexport interface IRpcWebSocketConfig {\r\n    responseTimeout: number;\r\n}\r\n\r\nexport type RpcUnidentifiedMessage =\r\n    | IRpcRequest\r\n    | IRpcNotification\r\n    | IRpcSuccessResponse\r\n    | IRpcErrorResponse;\r\n\r\nexport class RpcWebSocketClient {\r\n    // native websocket\r\n    public ws: IWebSocket;\r\n\r\n    private idAwaiter: {\r\n        [id: string]: (data?: any) => void;\r\n    } = {};\r\n\r\n    public onOpenHandlers: RpcEventFunction[] = [];\r\n    public onAnyMessageHandlers: RpcMessageEventFunction[] = [];\r\n\r\n    public onNotification: RpcNotificationEvent[] = [];\r\n    public onRequest: RpcRequestEvent[] = [];\r\n    public onSuccessResponse: RpcSuccessResponseEvent[] = [];\r\n    public onErrorResponse: RpcErrorResponseEvent[] = [];\r\n\r\n    public onErrorHandlers: RpcEventFunction[] = [];\r\n    public onCloseHandlers: RpcCloseEventFunction[] = [];\r\n\r\n    public config: IRpcWebSocketConfig = {\r\n        responseTimeout: 10000\r\n    };\r\n\r\n    // constructor\r\n    /**\r\n     * Does not start WebSocket connection!\r\n     * You need to call connect() method first.\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public constructor() {\r\n        this.ws = undefined as any;\r\n    }\r\n\r\n    // public\r\n    /**\r\n     * Starts WebSocket connection. Returns Promise when connection is established.\r\n     * @param {string} url\r\n     * @param {(string | string[])} [protocols]\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public connect(url: string, protocols?: string | string[]) {\r\n        this.ws = new WebSocket(url, protocols);\r\n        return this.listen();\r\n    }\r\n\r\n    // events\r\n    public onOpen(fn: RpcEventFunction) {\r\n        this.onOpenHandlers.push(fn);\r\n    }\r\n\r\n    /**\r\n     * Native onMessage event. DO NOT USE THIS unless you really have to or for debugging purposes.\r\n     * Proper RPC events are onRequest, onNotification, onSuccessResponse and onErrorResponse (or just awaiting response).\r\n     * @param {RpcMessageEventFunction} fn\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public onAnyMessage(fn: RpcMessageEventFunction) {\r\n        this.onAnyMessageHandlers.push(fn);\r\n    }\r\n\r\n    public onError(fn: RpcEventFunction) {\r\n        this.onErrorHandlers.push(fn);\r\n    }\r\n\r\n    public onClose(fn: RpcCloseEventFunction) {\r\n        this.onCloseHandlers.push(fn);\r\n    }\r\n\r\n    /**\r\n     * Appends onmessage listener on native websocket with RPC handlers.\r\n     * If onmessage function was already there, it will call it on beggining.\r\n     * Useful if you want to use RPC WebSocket Client on already established WebSocket along with function changeSocket().\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public listenMessages() {\r\n        let previousOnMessage: RpcMessageEventFunction | undefined;\r\n        if (this.ws.onmessage) {\r\n            previousOnMessage = this.ws.onmessage.bind(this.ws);\r\n        }\r\n\r\n        this.ws.onmessage = (e: IWebSocket.MessageEvent) => {\r\n            if (previousOnMessage) {\r\n                previousOnMessage(e);\r\n            }\r\n\r\n            for (const handler of this.onAnyMessageHandlers) {\r\n                handler(e);\r\n            }\r\n\r\n            const data: RpcUnidentifiedMessage = JSON.parse(e.data.toString());\r\n            if (this.isNotification(data)) {\r\n                // notification\r\n                for (const handler of this.onNotification) {\r\n                    handler(data);\r\n                }\r\n            } else if (this.isRequest(data)) {\r\n                // request\r\n                for (const handler of this.onRequest) {\r\n                    handler(data);\r\n                }\r\n                // responses\r\n            } else if (this.isSuccessResponse(data)) {\r\n                // success\r\n                for (const handler of this.onSuccessResponse) {\r\n                    handler(data);\r\n                }\r\n\r\n                // resolve awaiting function\r\n                this.idAwaiter[data.id](data.result);\r\n            } else if (this.isErrorResponse(data)) {\r\n                // error\r\n                for (const handler of this.onErrorResponse) {\r\n                    handler(data);\r\n                }\r\n\r\n                // resolve awaiting function\r\n                this.idAwaiter[data.id](data.error);\r\n            }\r\n        };\r\n    }\r\n\r\n    // communication\r\n\r\n    /**\r\n     * Creates and sends RPC request. Resolves when appropirate response is returned from server or after config.responseTimeout.\r\n     * @param {string} method\r\n     * @param {*} [params]\r\n     * @returns\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public call(method: string, params?: any) {\r\n        return new Promise((resolve, reject) => {\r\n            const data = this.buildRequest(method, params);\r\n\r\n            // give limited time for response\r\n            let timeout: number | NodeJS.Timeout;\r\n            if (this.config.responseTimeout) {\r\n                timeout = setTimeout(() => {\r\n                    // stop waiting for response\r\n                    delete this.idAwaiter[data.id];\r\n                    reject(\r\n                        `Awaiting response to \"${method}\" with id: ${data.id} timed out.`\r\n                    );\r\n                }, this.config.responseTimeout);\r\n            }\r\n\r\n            // expect response\r\n            this.idAwaiter[data.id] = (responseData?: any) => {\r\n                // stop timeout\r\n                clearInterval(timeout as number);\r\n                // stop waiting for response\r\n                delete this.idAwaiter[data.id];\r\n\r\n                if (this.isRpcError(responseData)) {\r\n                    reject(responseData);\r\n                    return;\r\n                }\r\n\r\n                resolve(responseData);\r\n            };\r\n\r\n            const json = JSON.stringify(data);\r\n            this.ws.send(json);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Creates and sends RPC Notification.\r\n     * @param {string} method\r\n     * @param {*} [params]\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public notify(method: string, params?: any) {\r\n        this.ws.send(JSON.stringify(this.buildNotification(method, params)));\r\n    }\r\n\r\n    // setup\r\n\r\n    /**\r\n     * You can provide custom id generation function to replace default uuid/v1.\r\n     * @param {() => string} idFn\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public customId(idFn: () => string) {\r\n        this.idFn = idFn;\r\n    }\r\n\r\n    /**\r\n     * Removed jsonrpc from sent messages. Good if you don't care about standards or need better performance.\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public noRpc() {\r\n        this.buildRequest = this.buildRequestBase;\r\n        this.buildNotification = this.buildNotificationBase;\r\n        this.buildRpcSuccessResponse = this.buildRpcSuccessResponseBase;\r\n        this.buildRpcErrorResponse = this.buildRpcErrorResponseBase;\r\n    }\r\n\r\n    /**\r\n     * Allows modifying configuration.\r\n     * @param {RpcWebSocketConfig} options\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public configure(options: IRpcWebSocketConfig) {\r\n        Object.assign(this.config, options);\r\n    }\r\n\r\n    /**\r\n     * Allows you to change used native WebSocket client to another one.\r\n     * If you have already-connected WebSocket, use this with listenMessages().\r\n     * @param {WebSocket} ws\r\n     * @memberof RpcWebSocketClient\r\n     */\r\n    public changeSocket(ws: IWebSocket) {\r\n        this.ws = ws;\r\n    }\r\n\r\n    // private\r\n\r\n    // events\r\n    private listen() {\r\n        return new Promise((resolve, reject) => {\r\n            this.ws.onopen = (e: IWebSocket.OpenEvent) => {\r\n                for (const handler of this.onOpenHandlers) {\r\n                    handler(e);\r\n                }\r\n                resolve(e);\r\n            };\r\n\r\n            // listen for messages\r\n            this.listenMessages();\r\n\r\n            // called before onclose\r\n            this.ws.onerror = (e: IWebSocket.ErrorEvent) => {\r\n                for (const handler of this.onErrorHandlers) {\r\n                    handler(e);\r\n                }\r\n            };\r\n\r\n            this.ws.onclose = (e: IWebSocket.CloseEvent) => {\r\n                for (const handler of this.onCloseHandlers) {\r\n                    handler(e);\r\n                }\r\n                reject(e);\r\n            };\r\n        });\r\n    }\r\n\r\n    // request\r\n    private buildRequest(method: string, params?: any): IRpcRequest {\r\n        const data = this.buildRequestBase(method, params);\r\n        data.jsonrpc = RpcVersions.RPC_VERSION;\r\n        return data;\r\n    }\r\n\r\n    private buildRequestBase(method: string, params?: any): IRpcRequest {\r\n        const data: IRpcRequest = {} as any;\r\n        data.id = this.idFn();\r\n        data.method = method;\r\n\r\n        if (params) {\r\n            data.params = params;\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    // notification\r\n    private buildNotification(method: string, params?: any): IRpcNotification {\r\n        const data = this.buildNotificationBase(method, params);\r\n        data.jsonrpc = RpcVersions.RPC_VERSION;\r\n        return data;\r\n    }\r\n\r\n    private buildNotificationBase(\r\n        method: string,\r\n        params?: any\r\n    ): IRpcNotification {\r\n        const data: IRpcNotification = {} as any;\r\n        data.method = method;\r\n\r\n        if (params) {\r\n            data.params = params;\r\n        }\r\n\r\n        return data;\r\n    }\r\n\r\n    // success response\r\n    private buildRpcSuccessResponse(\r\n        id: RpcId,\r\n        result: any\r\n    ): IRpcSuccessResponse {\r\n        const data = this.buildRpcSuccessResponseBase(id, result);\r\n        data.jsonrpc = RpcVersions.RPC_VERSION;\r\n        return data;\r\n    }\r\n\r\n    private buildRpcSuccessResponseBase(\r\n        id: RpcId,\r\n        result: any\r\n    ): IRpcSuccessResponse {\r\n        const data: IRpcSuccessResponse = {} as any;\r\n        data.id = id;\r\n        data.result = result;\r\n        return data;\r\n    }\r\n\r\n    // error response\r\n    private buildRpcErrorResponse(\r\n        id: RpcId,\r\n        error: IRpcError\r\n    ): IRpcErrorResponse {\r\n        const data = this.buildRpcErrorResponseBase(id, error);\r\n        data.jsonrpc = RpcVersions.RPC_VERSION;\r\n        return data;\r\n    }\r\n\r\n    private buildRpcErrorResponseBase(\r\n        id: RpcId,\r\n        error: IRpcError\r\n    ): IRpcErrorResponse {\r\n        const data: IRpcErrorResponse = {} as any;\r\n        data.id = id;\r\n        data.error = error;\r\n        return data;\r\n    }\r\n\r\n    private idFn(): RpcId {\r\n        return v1();\r\n    }\r\n\r\n    // tests\r\n    private isNotification(\r\n        data: RpcUnidentifiedMessage\r\n    ): data is IRpcNotification {\r\n        return !(data as any).id;\r\n    }\r\n\r\n    private isRequest(data: RpcUnidentifiedMessage): data is IRpcRequest {\r\n        return (data as any).method;\r\n    }\r\n\r\n    private isSuccessResponse(\r\n        data: RpcUnidentifiedMessage\r\n    ): data is IRpcSuccessResponse {\r\n        return data.hasOwnProperty(`result`);\r\n    }\r\n\r\n    private isErrorResponse(\r\n        data: RpcUnidentifiedMessage\r\n    ): data is IRpcErrorResponse {\r\n        return data.hasOwnProperty(`error`);\r\n    }\r\n\r\n    private isRpcError(data: any): data is IRpcError {\r\n        return typeof data?.code !== 'undefined';\r\n    }\r\n}\r\n"],"names":["RpcVersions"],"mappings":"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"}